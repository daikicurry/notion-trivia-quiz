<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雑学クイズ</title>
    <style>
        /* 既存のスタイル */
        .all-data-button {
            width: 100%;
            margin: 10px 0;
            padding: 12px;
            background-color: #198754;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .all-data-button:hover {
            background-color: #146c43;
        }
        .all-data-button.active {
            background-color: #0f5132;
        }
        .tag-toggle-button {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tag-sections {
            display: none;
        }
        .tag-sections.show {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        /* その他の既存のスタイル */
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>雑学クイズ</h1>
        
        <button id="allDataButton" class="all-data-button" onclick="handleAllDataClick()">
            データベース全体から出題
        </button>

        <button class="tag-toggle-button" onclick="toggleTagSections()">
            <span>タグでフィルター</span>
            <span id="tagToggleIcon">▼</span>
        </button>

        <div id="tagSections" class="tag-sections">
            <div class="tag-section">
                <h3>含めるタグ</h3>
                <div id="includeTagList" class="tag-list"></div>
            </div>
            <div class="tag-section">
                <h3>除外するタグ</h3>
                <div id="excludeTagList" class="tag-list"></div>
            </div>
        </div>

        <div id="quizDisplay" class="quiz-display">
            スタートボタンを押してください
        </div>

        <div class="button-container">
            <button id="startButton" class="control-button">スタート</button>
            <button id="showSupplementButton" class="control-button" disabled>補足を表示</button>
            <button id="showNotionButton" class="control-button" disabled>Notionで開く</button>
            <button id="nextButton" class="control-button" disabled>次の問題</button>
        </div>
    </div>

    <script>
        let quizData = [];
        let currentQuiz = null;
        let supplementShown = false;
        const includedTags = new Set();
        const excludedTags = new Set();
        let isUsingAllData = false;

        function toggleTagSections() {
            const sections = document.getElementById('tagSections');
            const icon = document.getElementById('tagToggleIcon');
            sections.classList.toggle('show');
            icon.textContent = sections.classList.contains('show') ? '▲' : '▼';
        }

        async function handleAllDataClick() {
            const button = document.getElementById('allDataButton');
            button.classList.add('active');
            isUsingAllData = true;
            includedTags.clear();
            excludedTags.clear();
            updateCheckboxes();
            await fetchQuizData(true);
            startQuiz();
        }

        // 他のJavaScript関数は変更なし

        // 初期化時にタグセクションを非表示に
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('tagSections').classList.remove('show');
        });
    </script>
</body>
</html>
